<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#6B46C1">
    <meta name="description" content="Planner Premium ULTRA - Organize sua vida com gamifica√ß√£o e produtividade avan√ßada">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Planner ULTRA">
    <title>‚ú® Planner Premium ULTRA - Cutting Edge</title>
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="/manifest.json">
    
    <!-- √çcones para iOS -->
    <link rel="apple-touch-icon" href="/icon-152.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/icon-72.png">
    <link rel="apple-touch-icon" sizes="96x96" href="/icon-96.png">
    <link rel="apple-touch-icon" sizes="128x128" href="/icon-128.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/icon-144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/icon-152.png">
    <link rel="apple-touch-icon" sizes="192x192" href="/icon-192.png">
    <link rel="apple-touch-icon" sizes="384x384" href="/icon-384.png">
    <link rel="apple-touch-icon" sizes="512x512" href="/icon-512.png">
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" sizes="32x32" href="/icon-72.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/icon-72.png">
    
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bcryptjs/2.4.3/bcrypt.min.js"></script>
    
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root { 
            --primary: #6B46C1; --secondary: #EC4899; --success: #10B981; 
            --danger: #EF4444; --warning: #F59E0B; --dark: #1F2937; 
            --light: #F9FAFB; --gray: #E5E7EB; 
        }
        body { font-family: 'Segoe UI', sans-serif; background: linear-gradient(135deg, #667eea, #764ba2); color: var(--dark); min-height: 100vh; }
        
        @keyframes levelUp {
            0% { transform: scale(0.5) rotate(-10deg); opacity: 0; }
            50% { transform: scale(1.2) rotate(5deg); opacity: 1; }
            100% { transform: scale(1) rotate(0deg); opacity: 1; }
        }
        
        @keyframes confetti {
            0% { transform: translateY(0) rotate(0deg); opacity: 1; }
            100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
        }
        
        .confetti { position: fixed; width: 10px; height: 10px; z-index: 10000; pointer-events: none; }
        
        .level-up-modal {
            display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
            z-index: 9999; background: white; padding: 3rem; border-radius: 20px;
            box-shadow: 0 25px 50px rgba(0,0,0,0.3); text-align: center; animation: levelUp 0.6s ease;
        }
        
        .level-up-modal.active { display: block; }
        .level-up-icon { font-size: 5em; margin-bottom: 1rem; }
        .level-up-title { font-size: 2em; font-weight: 800; background: linear-gradient(135deg, var(--primary), var(--secondary)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        
        .auth-container { min-height: 100vh; display: flex; align-items: center; justify-content: center; padding: 1rem; }
        .auth-box { background: white; border-radius: 20px; padding: 2rem; width: 100%; max-width: 400px; box-shadow: 0 25px 50px rgba(0,0,0,0.25); }
        .auth-logo { text-align: center; margin-bottom: 1.5rem; }
        .auth-logo-icon { font-size: 3em; }
        .auth-logo h1 { font-size: 1.4em; background: linear-gradient(135deg, var(--primary), var(--secondary)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }
        .trial-badge { background: linear-gradient(135deg, #10B981, #059669); color: white; padding: 0.5rem 1rem; border-radius: 20px; font-size: 0.85em; font-weight: 700; margin: 0.8rem 0; display: inline-block; }
        .auth-tabs { display: flex; margin-bottom: 1.5rem; background: var(--gray); border-radius: 10px; padding: 4px; }
        .auth-tab { flex: 1; padding: 0.6rem; border: none; background: transparent; cursor: pointer; font-weight: 600; border-radius: 8px; color: #666; font-size: 0.9em; }
        .auth-tab.active { background: white; color: var(--primary); }
        .auth-form { display: none; }
        .auth-form.active { display: block; }
        .form-group { margin-bottom: 1rem; }
        .form-group label { display: block; margin-bottom: 0.3rem; font-weight: 600; font-size: 0.85em; }
        .form-group input, .form-group select, .form-group textarea { width: 100%; padding: 0.75rem; border: 2px solid var(--gray); border-radius: 8px; font-size: 1em; font-family: inherit; }
        .form-group input:focus, .form-group select:focus, .form-group textarea:focus { outline: none; border-color: var(--primary); }
        .form-group textarea { min-height: 100px; resize: vertical; }
        .btn-auth { width: 100%; padding: 0.9rem; border: none; border-radius: 10px; font-weight: 700; cursor: pointer; background: linear-gradient(135deg, var(--primary), var(--secondary)); color: white; font-size: 1em; }
        .btn-auth:disabled { opacity: 0.6; cursor: not-allowed; }
        .auth-msg { padding: 0.7rem; border-radius: 8px; margin-bottom: 1rem; font-size: 0.85em; display: none; }
        .auth-error { background: #FEE2E2; color: #DC2626; }
        .auth-success { background: #D1FAE5; color: #059669; }
        
        .trial-banner { padding: 1rem; text-align: center; font-weight: 700; font-size: 0.9em; }
        .trial-banner.warning { background: linear-gradient(135deg, #F59E0B, #D97706); color: white; }
        .trial-banner.danger { background: linear-gradient(135deg, #EF4444, #DC2626); color: white; animation: pulse 1.5s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.8; } }
        
        .paywall-overlay { display: none; position: fixed; z-index: 9999; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); align-items: center; justify-content: center; padding: 1rem; }
        .paywall-overlay.active { display: flex; }
        .paywall-box { background: white; border-radius: 20px; padding: 2.5rem; max-width: 500px; width: 100%; text-align: center; }
        .paywall-icon { font-size: 4em; margin-bottom: 1rem; }
        .paywall-title { font-size: 2em; font-weight: 800; margin-bottom: 0.5rem; background: linear-gradient(135deg, var(--primary), var(--secondary)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .price-box { background: linear-gradient(135deg, #F3E8FF, #E9D5FF); border-radius: 15px; padding: 1.5rem; margin-bottom: 1.5rem; }
        .price-amount { font-size: 3em; font-weight: 800; color: var(--primary); }
        .btn-subscribe { width: 100%; padding: 1.2rem; border: none; border-radius: 12px; font-weight: 800; font-size: 1.1em; cursor: pointer; background: linear-gradient(135deg, var(--primary), var(--secondary)); color: white; }
        
        .app-container { display: none; background: linear-gradient(135deg, #F9FAFB, #F3E8FF); min-height: 100vh; }
        .app-container.active { display: block; }
        .navbar { background: linear-gradient(135deg, var(--primary), var(--secondary)); color: white; padding: 1rem; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 0.5rem; }
        .navbar-title { font-size: 1.2em; font-weight: 800; }
        .navbar-user { display: flex; align-items: center; gap: 0.5rem; flex-wrap: wrap; }
        .user-badge { background: rgba(255,255,255,0.2); padding: 0.4rem 0.8rem; border-radius: 15px; font-size: 0.75em; }
        .level-badge { background: linear-gradient(135deg, #F59E0B, #D97706); padding: 0.4rem 0.8rem; border-radius: 15px; font-size: 0.75em; font-weight: 700; cursor: pointer; }
        .streak-badge { background: linear-gradient(135deg, #EF4444, #DC2626); padding: 0.4rem 0.8rem; border-radius: 15px; font-size: 0.75em; font-weight: 700; }
        .btn-nav { background: rgba(255,255,255,0.2); border: 1px solid white; color: white; padding: 0.4rem 0.8rem; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 0.8em; }
        .btn-nav:hover { background: white; color: var(--primary); }
        
        .tab-menu { display: flex; gap: 0.5rem; background: white; padding: 0.5rem; border-radius: 10px; margin: 1rem auto; max-width: 800px; overflow-x: auto; }
        .tab-btn { flex: 1; padding: 0.7rem; border: none; background: transparent; cursor: pointer; font-weight: 600; border-radius: 6px; font-size: 0.9em; white-space: nowrap; }
        .tab-btn.active { background: linear-gradient(135deg, var(--primary), var(--secondary)); color: white; }
        
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        
        .container { max-width: 1400px; margin: 0 auto; padding: 1.5rem 1rem; }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 1.5rem; }
        .stat-card { background: white; border-radius: 12px; padding: 1.5rem; box-shadow: 0 4px 15px rgba(0,0,0,0.08); text-align: center; }
        .stat-icon { font-size: 2.5em; margin-bottom: 0.5rem; }
        .stat-value { font-size: 2em; font-weight: 800; color: var(--primary); }
        .stat-label { color: #666; font-size: 0.85em; margin-top: 0.3rem; }
        
        .xp-bar { background: var(--gray); border-radius: 20px; height: 30px; overflow: hidden; margin: 1rem 0; position: relative; }
        .xp-fill { background: linear-gradient(135deg, #10B981, #059669); height: 100%; transition: width 0.5s ease; display: flex; align-items: center; justify-content: center; color: white; font-weight: 700; font-size: 0.85em; }
        
        .achievements-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); gap: 1rem; }
        .achievement { background: white; border-radius: 10px; padding: 1rem; text-align: center; box-shadow: 0 4px 15px rgba(0,0,0,0.08); }
        .achievement.locked { opacity: 0.3; }
        .achievement-icon { font-size: 2.5em; }
        .achievement-name { font-size: 0.75em; font-weight: 600; margin-top: 0.3rem; }
        
        .chart-container { background: white; border-radius: 12px; padding: 1.5rem; box-shadow: 0 4px 15px rgba(0,0,0,0.08); margin-bottom: 1.5rem; }
        .chart-title { font-size: 1.1em; font-weight: 700; margin-bottom: 1rem; }
        
        .planner-types { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 1.5rem; }
        .planner-card { background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 4px 15px rgba(0,0,0,0.08); cursor: pointer; border-top: 4px solid; transition: transform 0.2s; }
        .planner-card:hover { transform: translateY(-3px); }
        .planner-header { color: white; padding: 1rem; text-align: center; }
        .planner-icon { font-size: 2em; }
        .planner-title { font-size: 0.95em; font-weight: 700; margin-top: 0.3rem; }
        .planner-body { padding: 1rem; }
        .btn-criar { width: 100%; padding: 0.6rem; background: linear-gradient(135deg, var(--primary), var(--secondary)); color: white; border: none; border-radius: 6px; font-weight: 700; cursor: pointer; font-size: 0.9em; }
        
        .planners-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 1rem; }
        .planner-item { color: white; border-radius: 10px; padding: 1rem; }
        .planner-item-nome { font-weight: 700; margin-bottom: 0.2rem; }
        .planner-item-info { font-size: 0.75em; opacity: 0.9; margin-bottom: 0.6rem; }
        .planner-item-acoes { display: flex; gap: 0.3rem; }
        .planner-item-acoes button { flex: 1; padding: 0.4rem; background: rgba(255,255,255,0.2); color: white; border: 1px solid white; border-radius: 4px; cursor: pointer; font-size: 0.7em; font-weight: 600; }
        
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); overflow-y: auto; }
        .modal-content { background: white; margin: 2% auto; padding: 2rem; border-radius: 12px; width: 95%; max-width: 900px; max-height: 90vh; overflow-y: auto; }
        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; border-bottom: 2px solid var(--gray); padding-bottom: 1rem; }
        .close-modal { font-size: 1.5em; cursor: pointer; background: none; border: none; color: #999; }
        
        .form-row { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 1rem; }
        .form-row-half { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1rem; }
        
        .tags-input { display: flex; flex-wrap: wrap; gap: 0.5rem; padding: 0.5rem; border: 2px solid var(--gray); border-radius: 8px; min-height: 45px; }
        .tag { background: linear-gradient(135deg, var(--primary), var(--secondary)); color: white; padding: 0.3rem 0.6rem; border-radius: 15px; font-size: 0.85em; display: flex; align-items: center; gap: 0.3rem; }
        .tag-remove { cursor: pointer; font-weight: bold; }
        .tag-input-field { border: none; outline: none; flex: 1; min-width: 100px; }
        
        .subtask-list { margin-top: 1rem; }
        .subtask-item { background: var(--light); padding: 0.7rem; border-radius: 6px; margin-bottom: 0.5rem; display: flex; gap: 0.6rem; align-items: center; }
        .subtask-checkbox { width: 18px; height: 18px; cursor: pointer; }
        .subtask-text { flex: 1; }
        
        .reminder-list { margin-top: 1rem; }
        .reminder-item { background: var(--light); padding: 0.7rem; border-radius: 6px; margin-bottom: 0.5rem; display: flex; justify-content: space-between; align-items: center; }
        
        .anexo-list { margin-top: 1rem; display: flex; flex-wrap: wrap; gap: 0.5rem; }
        .anexo-item { background: var(--light); padding: 0.5rem 0.8rem; border-radius: 6px; font-size: 0.85em; display: flex; align-items: center; gap: 0.5rem; }
        
        .ai-suggestion { background: linear-gradient(135deg, #F3E8FF, #E9D5FF); padding: 1rem; border-radius: 8px; margin-bottom: 1rem; border-left: 4px solid var(--primary); }
        .ai-suggestion-icon { font-size: 1.2em; margin-right: 0.5rem; }
        
        .tarefa-item { background: var(--light); padding: 1rem; border-radius: 8px; margin-bottom: 0.8rem; border-left: 4px solid var(--primary); cursor: pointer; transition: all 0.2s; }
        .tarefa-item:hover { transform: translateX(5px); box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        .tarefa-header { display: flex; gap: 0.8rem; align-items: flex-start; margin-bottom: 0.5rem; }
        .tarefa-checkbox { width: 20px; height: 20px; cursor: pointer; margin-top: 0.2rem; }
        .tarefa-conteudo { flex: 1; }
        .tarefa-titulo { font-weight: 700; font-size: 1em; margin-bottom: 0.3rem; }
        .tarefa-descricao { font-size: 0.85em; color: #666; margin-bottom: 0.5rem; }
        .tarefa-meta { display: flex; flex-wrap: wrap; gap: 0.5rem; font-size: 0.75em; color: #666; }
        .tarefa-meta-item { background: white; padding: 0.2rem 0.5rem; border-radius: 4px; }
        .tarefa-actions { display: flex; gap: 0.5rem; }
        .btn-icon { padding: 0.3rem 0.6rem; background: var(--gray); border: none; border-radius: 4px; cursor: pointer; font-size: 0.85em; }
        .btn-icon:hover { background: var(--primary); color: white; }
        .btn-del { background: var(--danger); color: white; }
        
        .view-switcher { display: flex; gap: 0.5rem; background: white; padding: 0.5rem; border-radius: 8px; margin-bottom: 1rem; }
        .view-btn { flex: 1; padding: 0.6rem; border: none; background: transparent; cursor: pointer; font-weight: 600; border-radius: 6px; font-size: 0.85em; }
        .view-btn.active { background: var(--primary); color: white; }
        
        .kanban-board { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1rem; }
        .kanban-column { background: white; border-radius: 12px; padding: 1rem; }
        .kanban-header { font-weight: 700; margin-bottom: 1rem; padding-bottom: 0.5rem; border-bottom: 2px solid var(--gray); }
        .kanban-card { background: var(--light); padding: 1rem; border-radius: 8px; margin-bottom: 0.8rem; cursor: move; }
        
        .calendar-view { background: white; border-radius: 12px; padding: 1.5rem; }
        .calendar-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; }
        .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 0.5rem; }
        .calendar-day-header { text-align: center; font-weight: 700; padding: 0.5rem; font-size: 0.85em; }
        .calendar-day { border: 1px solid var(--gray); border-radius: 8px; padding: 0.5rem; min-height: 100px; font-size: 0.85em; }
        .calendar-day-number { font-weight: 700; margin-bottom: 0.3rem; }
        .calendar-task { background: var(--primary); color: white; padding: 0.2rem 0.4rem; border-radius: 4px; font-size: 0.7em; margin-bottom: 0.2rem; cursor: pointer; }
        
        .timeline-view { background: white; border-radius: 12px; padding: 1.5rem; }
        .timeline-item { display: flex; gap: 1rem; margin-bottom: 1.5rem; }
        .timeline-date { min-width: 100px; font-weight: 700; color: var(--primary); }
        .timeline-content { flex: 1; border-left: 3px solid var(--primary); padding-left: 1rem; }
        
        .btn-primario { padding: 0.8rem 1.5rem; background: linear-gradient(135deg, var(--primary), var(--secondary)); color: white; border: none; border-radius: 8px; font-weight: 700; cursor: pointer; }
        .btn-primario:hover { opacity: 0.9; }
        .btn-secundario { padding: 0.8rem 1.5rem; background: var(--gray); color: var(--dark); border: none; border-radius: 8px; font-weight: 700; cursor: pointer; }
        .btn-secundario:hover { background: #d1d5db; }
        
        .loading { text-align: center; padding: 2rem; }
        .spinner { width: 40px; height: 40px; border: 4px solid var(--gray); border-top-color: var(--primary); border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 1rem; }
        @keyframes spin { to { transform: rotate(360deg); } }
        
        .notification-permission { background: linear-gradient(135deg, #3B82F6, #1D4ED8); color: white; padding: 1rem; border-radius: 8px; margin-bottom: 1rem; display: flex; justify-content: space-between; align-items: center; }
        
        @media (max-width: 768px) {
            .modal-content { width: 98%; padding: 1rem; }
            .form-row, .form-row-half { grid-template-columns: 1fr; }
            .kanban-board { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div class="loading" id="loadingScreen">
        <div class="spinner"></div>
        <p>Inicializando sistema avan√ßado...</p>
    </div>

    <div class="auth-container" id="authContainer" style="display:none;">
        <div class="auth-box">
            <div class="auth-logo">
                <div class="auth-logo-icon">‚ú®</div>
                <h1>Planner Premium ULTRA</h1>
                <div class="trial-badge">üéÅ 7 dias gr√°tis ‚Ä¢ R$ 19,99/m√™s</div>
            </div>
            <div class="auth-tabs">
                <button class="auth-tab active" onclick="showTab('login')">Entrar</button>
                <button class="auth-tab" onclick="showTab('signup')">Criar Conta</button>
            </div>
            <div id="authError" class="auth-msg auth-error"></div>
            <div id="authSuccess" class="auth-msg auth-success"></div>

            <form id="loginForm" class="auth-form active" onsubmit="handleLogin(event)">
                <div class="form-group"><label>Email</label><input type="email" id="loginEmail" required></div>
                <div class="form-group"><label>Senha</label><input type="password" id="loginPassword" required></div>
                <button type="submit" class="btn-auth" id="loginBtn">Entrar</button>
            </form>

            <form id="signupForm" class="auth-form" onsubmit="handleSignup(event)">
                <div class="form-group"><label>Nome Completo</label><input type="text" id="signupName" required></div>
                <div class="form-group"><label>Email</label><input type="email" id="signupEmail" required></div>
                <div class="form-group"><label>Senha (m√≠n. 6)</label><input type="password" id="signupPassword" minlength="6" required></div>
                <button type="submit" class="btn-auth" id="signupBtn">üéÅ Come√ßar Trial Gr√°tis</button>
            </form>
        </div>
    </div>

    <div class="paywall-overlay" id="paywallOverlay">
        <div class="paywall-box">
            <div class="paywall-icon">üîí</div>
            <h1 class="paywall-title">Trial Expirado</h1>
            <p style="color:#666; margin-bottom:2rem;">Assine agora para continuar!</p>
            <div class="price-box">
                <div class="price-amount">R$ 19,99</div>
                <div style="color:#666; font-size:0.9em;">por m√™s</div>
            </div>
            <button class="btn-subscribe" onclick="redirectToStripe()">üí≥ Assinar Agora</button>
        </div>
    </div>

    <div class="level-up-modal" id="levelUpModal">
        <div class="level-up-icon">üéâ</div>
        <h2 class="level-up-title">Level Up!</h2>
        <p style="font-size:1.5em; margin:1rem 0;">N√≠vel <span id="newLevel">2</span></p>
        <button class="btn-primario" onclick="closeLevelUp()">Continuar</button>
    </div>

    <div id="trialBanner" class="trial-banner" style="display:none;"></div>

    <div class="app-container" id="appContainer">
        <div class="navbar">
            <div class="navbar-title">‚ú® Planner Premium ULTRA</div>
            <div class="navbar-user">
                <span class="level-badge" onclick="openTab('stats')" id="levelBadge">‚≠ê N√≠vel 1</span>
                <span class="streak-badge" id="streakBadge">üî• 0 dias</span>
                <span class="user-badge">üë§ <span id="userName">User</span></span>
                <button class="btn-nav" onclick="logout()">Sair</button>
            </div>
        </div>

        <div class="container">
            <div id="notificationBanner" class="notification-permission" style="display:none;">
                <span>üîî Ative notifica√ß√µes para receber lembretes das suas tarefas!</span>
                <button class="btn-nav" onclick="requestNotificationPermission()">Ativar</button>
            </div>

            <div class="tab-menu">
                <button class="tab-btn active" onclick="openTab('planners')">üìã Planners</button>
                <button class="tab-btn" onclick="openTab('stats')">üìä Estat√≠sticas</button>
                <button class="tab-btn" onclick="openTab('achievements')">üèÜ Conquistas</button>
                <button class="tab-btn" onclick="openTab('calendar')">üìÖ Calend√°rio</button>
            </div>

            <div id="plannersTab" class="tab-content active">
                <h2 style="margin-bottom:0.8rem;">Criar Novo Planner</h2>
                <div class="planner-types">
                    <div class="planner-card" style="border-top-color:#10B981;" onclick="criarPlanner('todo')">
                        <div class="planner-header" style="background:linear-gradient(135deg,#10B981,#059669);"><div class="planner-icon">‚úÖ</div><div class="planner-title">To-Do</div></div>
                        <div class="planner-body"><button class="btn-criar">Criar</button></div>
                    </div>
                    <div class="planner-card" style="border-top-color:#3B82F6;" onclick="criarPlanner('projeto')">
                        <div class="planner-header" style="background:linear-gradient(135deg,#3B82F6,#1D4ED8);"><div class="planner-icon">üèóÔ∏è</div><div class="planner-title">Projetos</div></div>
                        <div class="planner-body"><button class="btn-criar">Criar</button></div>
                    </div>
                    <div class="planner-card" style="border-top-color:#F59E0B;" onclick="criarPlanner('habitos')">
                        <div class="planner-header" style="background:linear-gradient(135deg,#F59E0B,#D97706);"><div class="planner-icon">üî•</div><div class="planner-title">H√°bitos</div></div>
                        <div class="planner-body"><button class="btn-criar">Criar</button></div>
                    </div>
                    <div class="planner-card" style="border-top-color:#8B5CF6;" onclick="criarPlanner('financeiro')">
                        <div class="planner-header" style="background:linear-gradient(135deg,#8B5CF6,#6D28D9);"><div class="planner-icon">üí∞</div><div class="planner-title">Financeiro</div></div>
                        <div class="planner-body"><button class="btn-criar">Criar</button></div>
                    </div>
                </div>
                <div style="background:white; border-radius:12px; padding:1.5rem; box-shadow: 0 4px 15px rgba(0,0,0,0.08);">
                    <h2 style="margin-bottom:1rem;">üìã Meus Planners</h2>
                    <div class="planners-grid" id="meusPlanners"></div>
                </div>
            </div>

            <div id="statsTab" class="tab-content">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon">‚≠ê</div>
                        <div class="stat-value" id="statLevel">1</div>
                        <div class="stat-label">N√≠vel</div>
                        <div class="xp-bar">
                            <div class="xp-fill" id="xpBar" style="width:0%;">0/100 XP</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">üî•</div>
                        <div class="stat-value" id="statStreak">0</div>
                        <div class="stat-label">Dias de Streak</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">‚úÖ</div>
                        <div class="stat-value" id="statCompleted">0</div>
                        <div class="stat-label">Tarefas Conclu√≠das</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">üìà</div>
                        <div class="stat-value" id="statRate">0%</div>
                        <div class="stat-label">Taxa de Conclus√£o</div>
                    </div>
                </div>
                
                <div class="chart-container">
                    <h3 class="chart-title">üìä Produtividade Semanal</h3>
                    <canvas id="weeklyChart" height="80"></canvas>
                </div>
                
                <div class="chart-container">
                    <h3 class="chart-title">üéØ Tarefas por Prioridade</h3>
                    <canvas id="priorityChart" height="80"></canvas>
                </div>
            </div>

            <div id="achievementsTab" class="tab-content">
                <h2 style="margin-bottom:1rem;">üèÜ Conquistas Desbloqueadas</h2>
                <div class="achievements-grid" id="achievementsList"></div>
            </div>

            <div id="calendarTab" class="tab-content">
                <div class="calendar-view">
                    <div class="calendar-header">
                        <button class="btn-secundario" onclick="changeMonth(-1)">‚óÄ Anterior</button>
                        <h2 id="calendarTitle">Janeiro 2024</h2>
                        <button class="btn-secundario" onclick="changeMonth(1)">Pr√≥ximo ‚ñ∂</button>
                    </div>
                    <div class="calendar-grid" id="calendarGrid"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Criar Planner -->
    <div id="modalCriar" class="modal">
        <div class="modal-content">
            <div class="modal-header"><h2><span id="modalIcone"></span> <span id="modalTitulo">Novo</span></h2><button class="close-modal" onclick="fecharModal('modalCriar')">&times;</button></div>
            <div class="form-group"><label>Nome *</label><input type="text" id="inputNome"></div>
            <div class="form-group"><label>Data de In√≠cio</label><input type="date" id="inputData"></div>
            <div style="display:flex; gap:0.5rem;">
                <button class="btn-secundario" style="flex:1;" onclick="fecharModal('modalCriar')">Cancelar</button>
                <button class="btn-primario" style="flex:1;" onclick="salvarPlanner()">Criar</button>
            </div>
        </div>
    </div>

    <!-- Modal Ver Planner (CUTTING EDGE) -->
    <div id="modalVer" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><span id="verIcone"></span> <span id="verNome">Planner</span></h2>
                <button class="close-modal" onclick="fecharModal('modalVer')">&times;</button>
            </div>

            <div class="view-switcher">
                <button class="view-btn active" onclick="switchView('list')">üìã Lista</button>
                <button class="view-btn" onclick="switchView('kanban')">üìä Kanban</button>
                <button class="view-btn" onclick="switchView('timeline')">üìà Timeline</button>
            </div>

            <button class="btn-primario" style="width:100%; margin-bottom:1.5rem;" onclick="abrirModalNovaTarefa()">+ Nova Tarefa Avan√ßada</button>

            <div id="aiSuggestionBox" style="display:none;" class="ai-suggestion">
                <span class="ai-suggestion-icon">ü§ñ</span>
                <strong>Sugest√£o IA:</strong> <span id="aiSuggestionText"></span>
            </div>

            <div id="listView" class="tab-content active">
                <div id="listaTarefas"></div>
            </div>

            <div id="kanbanView" class="tab-content">
                <div class="kanban-board">
                    <div class="kanban-column">
                        <div class="kanban-header">üìã A Fazer</div>
                        <div id="kanbanTodo"></div>
                    </div>
                    <div class="kanban-column">
                        <div class="kanban-header">üöÄ Em Progresso</div>
                        <div id="kanbanProgress"></div>
                    </div>
                    <div class="kanban-column">
                        <div class="kanban-header">‚úÖ Conclu√≠do</div>
                        <div id="kanbanDone"></div>
                    </div>
                </div>
            </div>

            <div id="timelineView" class="tab-content">
                <div class="timeline-view" id="timelineContainer"></div>
            </div>
        </div>
    </div>

    <!-- Modal Nova Tarefa CUTTING EDGE -->
    <div id="modalNovaTarefa" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>‚ú® Nova Tarefa Avan√ßada</h2>
                <button class="close-modal" onclick="fecharModal('modalNovaTarefa')">&times;</button>
            </div>

            <div class="form-group">
                <label>T√≠tulo da Tarefa *</label>
                <input type="text" id="novaTarefaTitulo" placeholder="Ex: Reuni√£o com cliente">
            </div>

            <div class="form-group">
                <label>Descri√ß√£o Completa</label>
                <textarea id="novaTarefaDescricao" placeholder="Descreva detalhes, objetivos, contexto..."></textarea>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label>Categoria</label>
                    <select id="novaTarefaCategoria">
                        <option value="trabalho">üíº Trabalho</option>
                        <option value="pessoal">üè† Pessoal</option>
                        <option value="saude">üí™ Sa√∫de</option>
                        <option value="estudos">üìö Estudos</option>
                        <option value="financeiro">üí∞ Financeiro</option>
                        <option value="outro">üìå Outro</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Prioridade</label>
                    <select id="novaTarefaPrioridade">
                        <option value="baixa">üü¢ Baixa</option>
                        <option value="media">üü° M√©dia</option>
                        <option value="alta">üî¥ Alta</option>
                        <option value="urgente">üî• Urgente</option>
                        <option value="critica">‚ö° Cr√≠tica</option>
                    </select>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label>Data (DD/MM/AAAA)</label>
                    <input type="text" id="novaTarefaData" placeholder="25/12/2024">
                </div>
                <div class="form-group">
                    <label>Hora</label>
                    <input type="time" id="novaTarefaHora">
                </div>
                <div class="form-group">
                    <label>Dura√ß√£o (min)</label>
                    <input type="number" id="novaTarefaDuracao" placeholder="60">
                </div>
            </div>

            <div class="form-group">
                <label>Repetir Tarefa</label>
                <select id="novaTarefaRepetir">
                    <option value="nao">N√£o repetir</option>
                    <option value="diario">üìÖ Diariamente</option>
                    <option value="semanal">üìÜ Semanalmente</option>
                    <option value="mensal">üóìÔ∏è Mensalmente</option>
                </select>
            </div>

            <div class="form-group">
                <label>Tags (pressione Enter para adicionar)</label>
                <div class="tags-input" id="tagsContainer">
                    <input type="text" class="tag-input-field" id="tagInput" placeholder="Digite e pressione Enter">
                </div>
            </div>

            <div class="form-group">
                <label>‚è∞ Lembretes</label>
                <div class="form-row">
                    <select id="lembreteSelect">
                        <option value="">Selecione...</option>
                        <option value="5min">5 minutos antes</option>
                        <option value="15min">15 minutos antes</option>
                        <option value="30min">30 minutos antes</option>
                        <option value="1h">1 hora antes</option>
                        <option value="1dia">1 dia antes</option>
                    </select>
                    <button type="button" class="btn-secundario" onclick="adicionarLembrete()">+ Adicionar</button>
                </div>
                <div class="reminder-list" id="lembretesLista"></div>
            </div>

            <div class="form-group">
                <label>‚úÖ Subtarefas</label>
                <div style="display:flex; gap:0.5rem; margin-bottom:0.5rem;">
                    <input type="text" id="subtarefaInput" placeholder="Nome da subtarefa" style="flex:1;">
                    <button type="button" class="btn-secundario" onclick="adicionarSubtarefa()">+ Adicionar</button>
                </div>
                <div class="subtask-list" id="subtarefasLista"></div>
            </div>

            <div class="form-group">
                <label>üîó Links e Anexos</label>
                <div style="display:flex; gap:0.5rem; margin-bottom:0.5rem;">
                    <input type="text" id="anexoInput" placeholder="Cole o link aqui" style="flex:1;">
                    <button type="button" class="btn-secundario" onclick="adicionarAnexo()">+ Adicionar</button>
                </div>
                <div class="anexo-list" id="anexosLista"></div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label>Contexto</label>
                    <select id="novaTarefaContexto">
                        <option value="qualquer">üìç Qualquer lugar</option>
                        <option value="casa">üè† Casa</option>
                        <option value="escritorio">üè¢ Escrit√≥rio</option>
                        <option value="online">üíª Online</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Energia Necess√°ria</label>
                    <select id="novaTarefaEnergia">
                        <option value="baixa">üòä Baixa</option>
                        <option value="media">‚ö° M√©dia</option>
                        <option value="alta">üî• Alta</option>
                    </select>
                </div>
            </div>

            <div style="display:flex; gap:0.5rem; margin-top:1.5rem;">
                <button class="btn-secundario" style="flex:1;" onclick="fecharModal('modalNovaTarefa')">Cancelar</button>
                <button class="btn-primario" style="flex:1;" onclick="salvarNovaTarefa()">üíæ Salvar Tarefa</button>
            </div>
        </div>
    </div>

    <script>
        const SUPABASE_URL = 'https://szzirxygtjztusudfqsw.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InN6emlyeHlndGp6dHVzdWRmcXN3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM4NDk0NzEsImV4cCI6MjA3OTQyNTQ3MX0.zEMDaMA-DvcSiHmj4a3thB1Nnu9cEWGqfFes8R8lICA';
        const STRIPE_LINK = 'https://buy.stripe.com/test_6oE14q0lh7iW5sA9AA';
        
        let supabase = null;
        let currentUser = null;
        let planners = [];
        let plannerAberto = null;
        let tipoAtual = '';
        let currentView = 'list';
        let currentMonth = new Date().getMonth();
        let currentYear = new Date().getFullYear();
        let tempTags = [];
        let tempLembretes = [];
        let tempSubtarefas = [];
        let tempAnexos = [];
        
        const tipos = {
            'todo': { nome: 'To-Do', icone: '‚úÖ', cor: '#10B981' },
            'projeto': { nome: 'Projeto', icone: 'üèóÔ∏è', cor: '#3B82F6' },
            'habitos': { nome: 'H√°bitos', icone: 'üî•', cor: '#F59E0B' },
            'financeiro': { nome: 'Financeiro', icone: 'üí∞', cor: '#8B5CF6' }
        };
        
        const achievements = [
            { id: 'first_task', name: 'Primeira Tarefa', icon: 'üéØ', requirement: 1 },
            { id: 'task_master', name: 'Mestre das Tarefas', icon: 'üëë', requirement: 10 },
            { id: 'century', name: 'Centen√°rio', icon: 'üíØ', requirement: 100 },
            { id: 'week_streak', name: 'Streak 7 Dias', icon: 'üî•', requirement: 7 },
            { id: 'month_streak', name: 'Streak 30 Dias', icon: 'üí™', requirement: 30 },
            { id: 'level_10', name: 'N√≠vel 10', icon: '‚≠ê', requirement: 10 },
            { id: 'planner_pro', name: 'Planejador Pro', icon: 'üìã', requirement: 5 }
        ];

        async function init() {
            document.getElementById('inputData').value = new Date().toISOString().split('T')[0];
            document.getElementById('novaTarefaData').value = formatDateBR(new Date());
            
            try {
                supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
                document.getElementById('loadingScreen').style.display = 'none';
                document.getElementById('authContainer').style.display = 'flex';
                
                setupTagInput();
                checkNotificationSupport();
            } catch (err) {
                console.error('Erro:', err);
                alert('Erro ao conectar');
            }
        }
        
        init();

        function formatDateBR(date) {
            const d = new Date(date);
            const day = String(d.getDate()).padStart(2, '0');
            const month = String(d.getMonth() + 1).padStart(2, '0');
            const year = d.getFullYear();
            return `${day}/${month}/${year}`;
        }

        function parseDateBR(dateStr) {
            const parts = dateStr.split('/');
            if (parts.length === 3) {
                return `${parts[2]}-${parts[1]}-${parts[0]}`;
            }
            return dateStr;
        }

        function setupTagInput() {
            const tagInput = document.getElementById('tagInput');
            if (tagInput) {
                tagInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        e.preventDefault();
                        const tag = tagInput.value.trim();
                        if (tag && !tempTags.includes(tag)) {
                            tempTags.push(tag);
                            renderTags();
                            tagInput.value = '';
                        }
                    }
                });
            }
        }

        function renderTags() {
            const container = document.getElementById('tagsContainer');
            const tagInput = document.getElementById('tagInput');
            container.innerHTML = '';
            
            tempTags.forEach(tag => {
                const tagEl = document.createElement('div');
                tagEl.className = 'tag';
                tagEl.innerHTML = `${tag} <span class="tag-remove" onclick="removeTag('${tag}')">‚úï</span>`;
                container.appendChild(tagEl);
            });
            
            container.appendChild(tagInput);
        }

        function removeTag(tag) {
            tempTags = tempTags.filter(t => t !== tag);
            renderTags();
        }

        function adicionarLembrete() {
            const select = document.getElementById('lembreteSelect');
            const value = select.value;
            if (value && !tempLembretes.includes(value)) {
                tempLembretes.push(value);
                renderLembretes();
            }
        }

        function renderLembretes() {
            const container = document.getElementById('lembretesLista');
            const labels = {
                '5min': 'üîî 5 minutos antes',
                '15min': 'üîî 15 minutos antes',
                '30min': 'üîî 30 minutos antes',
                '1h': 'üîî 1 hora antes',
                '1dia': 'üîî 1 dia antes'
            };
            
            container.innerHTML = tempLembretes.map(l => `
                <div class="reminder-item">
                    <span>${labels[l]}</span>
                    <button class="btn-icon btn-del" onclick="removeLembrete('${l}')">‚úï</button>
                </div>
            `).join('');
        }

        function removeLembrete(lembrete) {
            tempLembretes = tempLembretes.filter(l => l !== lembrete);
            renderLembretes();
        }

        function adicionarSubtarefa() {
            const input = document.getElementById('subtarefaInput');
            const text = input.value.trim();
            if (text) {
                tempSubtarefas.push({ text, done: false });
                renderSubtarefas();
                input.value = '';
            }
        }

        function renderSubtarefas() {
            const container = document.getElementById('subtarefasLista');
            container.innerHTML = tempSubtarefas.map((s, i) => `
                <div class="subtask-item">
                    <input type="checkbox" class="subtask-checkbox" ${s.done ? 'checked' : ''} onchange="toggleSubtarefa(${i})">
                    <span class="subtask-text">${s.text}</span>
                    <button class="btn-icon btn-del" onclick="removeSubtarefa(${i})">‚úï</button>
                </div>
            `).join('');
        }

        function toggleSubtarefa(index) {
            tempSubtarefas[index].done = !tempSubtarefas[index].done;
            renderSubtarefas();
        }

        function removeSubtarefa(index) {
            tempSubtarefas.splice(index, 1);
            renderSubtarefas();
        }

        function adicionarAnexo() {
            const input = document.getElementById('anexoInput');
            const url = input.value.trim();
            if (url) {
                tempAnexos.push(url);
                renderAnexos();
                input.value = '';
            }
        }

        function renderAnexos() {
            const container = document.getElementById('anexosLista');
            container.innerHTML = tempAnexos.map((a, i) => `
                <div class="anexo-item">
                    üîó <a href="${a}" target="_blank">${a.substring(0, 30)}...</a>
                    <button class="btn-icon btn-del" onclick="removeAnexo(${i})">‚úï</button>
                </div>
            `).join('');
        }

        function removeAnexo(index) {
            tempAnexos.splice(index, 1);
            renderAnexos();
        }

        function checkNotificationSupport() {
            if ('Notification' in window && Notification.permission === 'default') {
                document.getElementById('notificationBanner').style.display = 'flex';
            }
        }

        async function requestNotificationPermission() {
            const permission = await Notification.requestPermission();
            if (permission === 'granted') {
                document.getElementById('notificationBanner').style.display = 'none';
                showNotification('üéâ Notifica√ß√µes Ativadas!', 'Voc√™ receber√° lembretes das suas tarefas.');
            }
        }

        function showNotification(title, body) {
            if ('Notification' in window && Notification.permission === 'granted') {
                new Notification(title, { body, icon: '‚ú®' });
            }
        }

        function showTab(t) {
            document.querySelectorAll('.auth-tab').forEach((el,i) => el.classList.toggle('active', (t==='login'&&i===0)||(t==='signup'&&i===1)));
            document.getElementById('loginForm').classList.toggle('active', t==='login');
            document.getElementById('signupForm').classList.toggle('active', t==='signup');
            hideMsg();
        }
        
        function showError(m) { 
            document.getElementById('authError').textContent=m; 
            document.getElementById('authError').style.display='block'; 
            document.getElementById('authSuccess').style.display='none'; 
        }
        
        function showSuccess(m) { 
            document.getElementById('authSuccess').textContent=m; 
            document.getElementById('authSuccess').style.display='block'; 
            document.getElementById('authError').style.display='none'; 
        }
        
        function hideMsg() { 
            document.getElementById('authError').style.display='none'; 
            document.getElementById('authSuccess').style.display='none'; 
        }

        async function handleSignup(e) {
            e.preventDefault();
            const name = document.getElementById('signupName').value.trim();
            const email = document.getElementById('signupEmail').value.trim().toLowerCase();
            const pass = document.getElementById('signupPassword').value;
            
            if (pass.length < 6) { showError('‚ùå Senha deve ter no m√≠nimo 6 caracteres!'); return; }
            
            document.getElementById('signupBtn').disabled = true;
            document.getElementById('signupBtn').textContent = 'Criando...';
            
            try {
                const { data: existing } = await supabase.from('users').select('email').eq('email', email).single();
                if (existing) {
                    showError('‚ùå Email j√° cadastrado!');
                    document.getElementById('signupBtn').disabled = false;
                    document.getElementById('signupBtn').textContent = 'üéÅ Come√ßar Trial Gr√°tis';
                    return;
                }
                
                const hashedPassword = await bcrypt.hash(pass, 10);
                const trialEndDate = new Date();
                trialEndDate.setDate(trialEndDate.getDate() + 7);
                
                const { data: user, error } = await supabase.from('users').insert([{ 
                    email, name, password: hashedPassword,
                    trial_end: trialEndDate.toISOString().split('T')[0],
                    subscription_status: 'trial',
                    xp: 0, level: 1, streak: 0, last_activity: new Date().toISOString().split('T')[0]
                }]).select().single();
                
                if (error) throw error;
                showSuccess('‚úÖ Conta criada! 7 dias gr√°tis ativados!');
                setTimeout(() => loginUser(user), 1500);
            } catch (err) {
                console.error('Erro signup:', err);
                showError('‚ùå Erro ao criar conta');
                document.getElementById('signupBtn').disabled = false;
                document.getElementById('signupBtn').textContent = 'üéÅ Come√ßar Trial Gr√°tis';
            }
        }

        async function handleLogin(e) {
            e.preventDefault();
            const email = document.getElementById('loginEmail').value.trim().toLowerCase();
            const pass = document.getElementById('loginPassword').value;
            
            document.getElementById('loginBtn').disabled = true;
            document.getElementById('loginBtn').textContent = 'Entrando...';
            
            try {
                const { data: user, error } = await supabase.from('users').select('*').eq('email', email).single();
                if (error || !user) {
                    showError('‚ùå Email n√£o encontrado!');
                    document.getElementById('loginBtn').disabled = false;
                    document.getElementById('loginBtn').textContent = 'Entrar';
                    return;
                }
                
                let isValid = false;
                if (user.password && user.password.startsWith('$2')) {
                    try {
                        isValid = await bcrypt.compare(pass, user.password);
                    } catch (bcryptErr) {
                        console.error('Erro bcrypt:', bcryptErr);
                        showError('‚ùå Erro ao validar senha. Tente novamente.');
                        document.getElementById('loginBtn').disabled = false;
                        document.getElementById('loginBtn').textContent = 'Entrar';
                        return;
                    }
                } else {
                    isValid = (user.password === pass);
                    if (isValid) {
                        try {
                            const hashedPassword = await bcrypt.hash(pass, 10);
                            await supabase.from('users').update({ password: hashedPassword }).eq('email', email);
                        } catch (hashErr) {
                            console.warn('Aviso: n√£o foi poss√≠vel migrar senha:', hashErr);
                        }
                    }
                }
                
                if (!isValid) {
                    showError('‚ùå Senha incorreta!');
                    document.getElementById('loginBtn').disabled = false;
                    document.getElementById('loginBtn').textContent = 'Entrar';
                    return;
                }
                
                loginUser(user);
            } catch (err) {
                console.error('Erro login:', err);
                showError('‚ùå Erro ao fazer login: ' + err.message);
                document.getElementById('loginBtn').disabled = false;
                document.getElementById('loginBtn').textContent = 'Entrar';
            }
        }

        function checkSubscriptionStatus(user) {
            const today = new Date().toISOString().split('T')[0];
            const trialEnd = user.trial_end;
            const status = user.subscription_status;
            
            if (status === 'active') {
                document.getElementById('trialBanner').style.display = 'none';
                document.getElementById('paywallOverlay').classList.remove('active');
                return true;
            }
            
            if (status === 'trial' && trialEnd) {
                const daysLeft = Math.ceil((new Date(trialEnd) - new Date(today)) / (1000 * 60 * 60 * 24));
                if (daysLeft <= 0) {
                    document.getElementById('paywallOverlay').classList.add('active');
                    return false;
                }
                if (daysLeft <= 2) {
                    const banner = document.getElementById('trialBanner');
                    banner.textContent = `üî• √öLTIMO DIA! Assine para n√£o perder acesso`;
                    banner.className = 'trial-banner danger';
                    banner.style.display = 'block';
                } else if (daysLeft <= 5) {
                    const banner = document.getElementById('trialBanner');
                    banner.textContent = `‚è∞ ${daysLeft} dias restantes ‚Ä¢ Assine agora`;
                    banner.className = 'trial-banner warning';
                    banner.style.display = 'block';
                }
                return true;
            }
            document.getElementById('paywallOverlay').classList.add('active');
            return false;
        }

        async function loginUser(user) {
            currentUser = user;
            if (!checkSubscriptionStatus(user)) return;
            
            await updateStreak();
            
            const { data: userPlanners } = await supabase.from('planners').select('*').eq('user_email', user.email);
            planners = userPlanners || [];
            
            document.getElementById('authContainer').style.display = 'none';
            document.getElementById('appContainer').classList.add('active');
            document.getElementById('userName').textContent = user.name.split(' ')[0];
            
            updateGamification();
            renderPlanners();
            renderAchievements();
            renderCharts();
            renderCalendar();
            showAISuggestions();
        }

        async function updateStreak() {
            const today = new Date().toISOString().split('T')[0];
            const lastActivity = currentUser.last_activity;
            
            if (lastActivity !== today) {
                const yesterday = new Date();
                yesterday.setDate(yesterday.getDate() - 1);
                const yesterdayStr = yesterday.toISOString().split('T')[0];
                
                let newStreak = currentUser.streak || 0;
                if (lastActivity === yesterdayStr) {
                    newStreak++;
                } else if (lastActivity !== today) {
                    newStreak = 1;
                }
                
                await supabase.from('users').update({ 
                    streak: newStreak, 
                    last_activity: today 
                }).eq('email', currentUser.email);
                
                currentUser.streak = newStreak;
            }
        }

        async function addXP(amount) {
            const newXP = (currentUser.xp || 0) + amount;
            const currentLevel = currentUser.level || 1;
            const xpForNextLevel = currentLevel * 100;
            
            let newLevel = currentLevel;
            let finalXP = newXP;
            
            if (newXP >= xpForNextLevel) {
                newLevel++;
                finalXP = newXP - xpForNextLevel;
                showLevelUp(newLevel);
                checkAchievements();
            }
            
            await supabase.from('users').update({ xp: finalXP, level: newLevel }).eq('email', currentUser.email);
            currentUser.xp = finalXP;
            currentUser.level = newLevel;
            updateGamification();
        }

        function showLevelUp(level) {
            document.getElementById('newLevel').textContent = level;
            document.getElementById('levelUpModal').classList.add('active');
            createConfetti();
            showNotification('üéâ Level Up!', `Voc√™ alcan√ßou o n√≠vel ${level}!`);
        }

        function closeLevelUp() {
            document.getElementById('levelUpModal').classList.remove('active');
        }

        function createConfetti() {
            const colors = ['#EC4899', '#6B46C1', '#10B981', '#F59E0B', '#3B82F6'];
            for (let i = 0; i < 50; i++) {
                setTimeout(() => {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti';
                    confetti.style.left = Math.random() * 100 + '%';
                    confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
                    confetti.style.animation = `confetti ${2 + Math.random() * 2}s linear forwards`;
                    document.body.appendChild(confetti);
                    setTimeout(() => confetti.remove(), 4000);
                }, i * 30);
            }
        }

        function updateGamification() {
            const level = currentUser.level || 1;
            const xp = currentUser.xp || 0;
            const streak = currentUser.streak || 0;
            const xpForNextLevel = level * 100;
            const xpPercent = (xp / xpForNextLevel) * 100;
            
            document.getElementById('levelBadge').textContent = `‚≠ê N√≠vel ${level}`;
            document.getElementById('streakBadge').textContent = `üî• ${streak} dias`;
            document.getElementById('statLevel').textContent = level;
            document.getElementById('statStreak').textContent = streak;
            document.getElementById('xpBar').style.width = xpPercent + '%';
            document.getElementById('xpBar').textContent = `${xp}/${xpForNextLevel} XP`;
        }

        async function checkAchievements() {
            const { data: tarefas } = await supabase.from('tarefas').select('*').in('planner_id', planners.map(p => p.id));
            const completed = tarefas?.filter(t => t.done).length || 0;
            
            const unlockedAchievements = [];
            if (completed >= 1) unlockedAchievements.push('first_task');
            if (completed >= 10) unlockedAchievements.push('task_master');
            if (completed >= 100) unlockedAchievements.push('century');
            if (currentUser.streak >= 7) unlockedAchievements.push('week_streak');
            if (currentUser.streak >= 30) unlockedAchievements.push('month_streak');
            if (currentUser.level >= 10) unlockedAchievements.push('level_10');
            if (planners.length >= 5) unlockedAchievements.push('planner_pro');
            
            await supabase.from('users').update({ 
                achievements: unlockedAchievements 
            }).eq('email', currentUser.email);
            
            currentUser.achievements = unlockedAchievements;
        }

        function renderAchievements() {
            const userAchievements = currentUser.achievements || [];
            const html = achievements.map(a => {
                const unlocked = userAchievements.includes(a.id);
                return `
                    <div class="achievement ${unlocked ? '' : 'locked'}">
                        <div class="achievement-icon">${a.icon}</div>
                        <div class="achievement-name">${a.name}</div>
                    </div>
                `;
            }).join('');
            document.getElementById('achievementsList').innerHTML = html;
        }

        async function renderCharts() {
            const { data: tarefas } = await supabase.from('tarefas').select('*').in('planner_id', planners.map(p => p.id));
            if (!tarefas || tarefas.length === 0) {
                document.getElementById('statCompleted').textContent = 0;
                document.getElementById('statRate').textContent = '0%';
                return;
            }
            
            const completed = tarefas.filter(t => t.done).length;
            const total = tarefas.length;
            const rate = total > 0 ? Math.round((completed / total) * 100) : 0;
            
            document.getElementById('statCompleted').textContent = completed;
            document.getElementById('statRate').textContent = rate + '%';
            
            const last7Days = [];
            for (let i = 6; i >= 0; i--) {
                const d = new Date();
                d.setDate(d.getDate() - i);
                last7Days.push(d.toISOString().split('T')[0]);
            }
            
            const weeklyData = last7Days.map(date => {
                return tarefas.filter(t => t.done && t.data === date).length;
            });
            
            new Chart(document.getElementById('weeklyChart'), {
                type: 'line',
                data: {
                    labels: last7Days.map(d => new Date(d).toLocaleDateString('pt-BR', {weekday:'short'})),
                    datasets: [{
                        label: 'Tarefas Conclu√≠das',
                        data: weeklyData,
                        borderColor: '#6B46C1',
                        backgroundColor: 'rgba(107, 70, 193, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: { responsive: true, maintainAspectRatio: true }
            });
            
            const prioData = {
                alta: tarefas.filter(t => t.prioridade === 'alta' || t.prioridade === 'urgente' || t.prioridade === 'critica').length,
                media: tarefas.filter(t => t.prioridade === 'media').length,
                baixa: tarefas.filter(t => t.prioridade === 'baixa').length
            };
            
            new Chart(document.getElementById('priorityChart'), {
                type: 'doughnut',
                data: {
                    labels: ['Alta/Urgente', 'M√©dia', 'Baixa'],
                    datasets: [{
                        data: [prioData.alta, prioData.media, prioData.baixa],
                        backgroundColor: ['#EF4444', '#F59E0B', '#10B981']
                    }]
                },
                options: { responsive: true, maintainAspectRatio: true }
            });
        }

        function redirectToStripe() {
            window.open(`${STRIPE_LINK}?client_reference_id=${currentUser.email}`, '_blank');
        }

        function logout() {
            currentUser = null;
            planners = [];
            document.getElementById('appContainer').classList.remove('active');
            document.getElementById('authContainer').style.display = 'flex';
            document.getElementById('paywallOverlay').classList.remove('active');
            showTab('login');
        }

        function openTab(tab) {
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            const tabs = ['planners', 'stats', 'achievements', 'calendar'];
            const index = tabs.indexOf(tab);
            if (index !== -1) {
                document.querySelectorAll('.tab-btn')[index].classList.add('active');
                document.getElementById(tab + 'Tab').classList.add('active');
                
                if (tab === 'stats') renderCharts();
                if (tab === 'achievements') renderAchievements();
                if (tab === 'calendar') renderCalendar();
            }
        }

        async function renderPlanners() {
            const c = document.getElementById('meusPlanners');
            if (!planners.length) {
                c.innerHTML = '<p style="text-align:center;color:#999;">Crie seu primeiro planner!</p>';
                return;
            }
            
            const html = await Promise.all(planners.map(async p => {
                const { data: tarefas } = await supabase.from('tarefas').select('*').eq('planner_id', p.id);
                const numTarefas = tarefas?.length || 0;
                return `
                    <div class="planner-item" style="background:linear-gradient(135deg,${tipos[p.tipo]?.cor || '#6B46C1'},${tipos[p.tipo]?.cor || '#6B46C1'}dd);">
                        <div class="planner-item-nome">${tipos[p.tipo]?.icone || 'üìã'} ${p.nome}</div>
                        <div class="planner-item-info">${numTarefas} tarefa${numTarefas !== 1 ? 's' : ''}</div>
                        <div class="planner-item-acoes">
                            <button onclick="abrirPlanner(${p.id})">Abrir</button>
                            <button onclick="deletarPlanner(${p.id})">Deletar</button>
                        </div>
                    </div>
                `;
            }));
            c.innerHTML = html.join('');
        }

        function criarPlanner(tipo) {
            tipoAtual = tipo;
            const t = tipos[tipo];
            document.getElementById('modalIcone').textContent = t.icone;
            document.getElementById('modalTitulo').textContent = 'Novo ' + t.nome;
            document.getElementById('inputNome').value = '';
            document.getElementById('modalCriar').style.display = 'block';
        }

        async function salvarPlanner() {
            const nome = document.getElementById('inputNome').value.trim();
            if (!nome) { alert('‚ùå Digite um nome!'); return; }
            
            try {
                const { data: newPlanner, error } = await supabase.from('planners').insert([{
                    user_email: currentUser.email,
                    tipo: tipoAtual,
                    nome: nome
                }]).select().single();
                
                if (error) throw error;
                planners.push(newPlanner);
                fecharModal('modalCriar');
                renderPlanners();
                await addXP(50);
            } catch (err) {
                console.error('Erro:', err);
                alert('‚ùå Erro ao criar');
            }
        }

        async function abrirPlanner(id) {
            const p = planners.find(x => x.id === id);
            if (!p) return;
            
            plannerAberto = id;
            document.getElementById('verIcone').textContent = tipos[p.tipo]?.icone || 'üìã';
            document.getElementById('verNome').textContent = p.nome;
            
            const { data: tarefas } = await supabase.from('tarefas').select('*').eq('planner_id', id).order('id');
            renderTarefas(tarefas || []);
            document.getElementById('modalVer').style.display = 'block';
        }

        function switchView(view) {
            currentView = view;
            document.querySelectorAll('.view-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('#modalVer .tab-content').forEach(content => content.classList.remove('active'));
            
            if (view === 'list') {
                document.querySelector('.view-btn:nth-child(1)').classList.add('active');
                document.getElementById('listView').classList.add('active');
            } else if (view === 'kanban') {
                document.querySelector('.view-btn:nth-child(2)').classList.add('active');
                document.getElementById('kanbanView').classList.add('active');
                renderKanban();
            } else if (view === 'timeline') {
                document.querySelector('.view-btn:nth-child(3)').classList.add('active');
                document.getElementById('timelineView').classList.add('active');
                renderTimeline();
            }
        }

        async function renderTarefas(tarefas) {
            const c = document.getElementById('listaTarefas');
            if (!tarefas.length) {
                c.innerHTML = '<p style="text-align:center;color:#999;">Nenhuma tarefa criada</p>';
                return;
            }
            
            const prioIcons = {
                'baixa': 'üü¢',
                'media': 'üü°',
                'alta': 'üî¥',
                'urgente': 'üî•',
                'critica': '‚ö°'
            };
            
            c.innerHTML = tarefas.map(t => {
                const data = t.data_formatada || formatDateBR(t.data);
                const hora = t.hora || '';
                const descricao = t.descricao ? t.descricao.substring(0, 80) + '...' : '';
                
                return `
                    <div class="tarefa-item">
                        <div class="tarefa-header">
                            <input type="checkbox" class="tarefa-checkbox" ${t.done ? 'checked' : ''} onchange="toggleTarefa(${t.id})">
                            <div class="tarefa-conteudo">
                                <div class="tarefa-titulo" style="${t.done ? 'text-decoration:line-through;opacity:0.6;' : ''}">${prioIcons[t.prioridade] || 'üìå'} ${t.titulo}</div>
                                ${descricao ? `<div class="tarefa-descricao">${descricao}</div>` : ''}
                                <div class="tarefa-meta">
                                    ${data ? `<span class="tarefa-meta-item">üìÖ ${data}${hora ? ' ' + hora : ''}</span>` : ''}
                                    ${t.categoria ? `<span class="tarefa-meta-item">${getCategoriaIcon(t.categoria)} ${t.categoria}</span>` : ''}
                                    ${t.duracao ? `<span class="tarefa-meta-item">‚è±Ô∏è ${t.duracao}min</span>` : ''}
                                </div>
                            </div>
                        </div>
                        <div class="tarefa-actions">
                            <button class="btn-icon" onclick="editarTarefa(${t.id})">‚úèÔ∏è</button>
                            <button class="btn-icon btn-del" onclick="deletarTarefa(${t.id})">üóëÔ∏è</button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function getCategoriaIcon(cat) {
            const icons = {
                'trabalho': 'üíº',
                'pessoal': 'üè†',
                'saude': 'üí™',
                'estudos': 'üìö',
                'financeiro': 'üí∞',
                'outro': 'üìå'
            };
            return icons[cat] || 'üìå';
        }

        async function renderKanban() {
            const { data: tarefas } = await supabase.from('tarefas').select('*').eq('planner_id', plannerAberto);
            if (!tarefas) return;
            
            const todo = tarefas.filter(t => !t.done && !t.em_progresso);
            const progress = tarefas.filter(t => !t.done && t.em_progresso);
            const done = tarefas.filter(t => t.done);
            
            document.getElementById('kanbanTodo').innerHTML = renderKanbanCards(todo);
            document.getElementById('kanbanProgress').innerHTML = renderKanbanCards(progress);
            document.getElementById('kanbanDone').innerHTML = renderKanbanCards(done);
        }

        function renderKanbanCards(tarefas) {
            if (!tarefas.length) return '<p style="color:#999;font-size:0.85em;">Nenhuma tarefa</p>';
            
            return tarefas.map(t => `
                <div class="kanban-card">
                    <div style="font-weight:700; margin-bottom:0.5rem;">${t.titulo}</div>
                    <div style="font-size:0.85em; color:#666;">${t.data_formatada || formatDateBR(t.data)}</div>
                </div>
            `).join('');
        }

        async function renderTimeline() {
            const { data: tarefas } = await supabase.from('tarefas').select('*').eq('planner_id', plannerAberto).order('data');
            if (!tarefas || !tarefas.length) {
                document.getElementById('timelineContainer').innerHTML = '<p style="text-align:center;color:#999;">Nenhuma tarefa</p>';
                return;
            }
            
            const grouped = {};
            tarefas.forEach(t => {
                const date = t.data_formatada || formatDateBR(t.data);
                if (!grouped[date]) grouped[date] = [];
                grouped[date].push(t);
            });
            
            const html = Object.keys(grouped).map(date => `
                <div class="timeline-item">
                    <div class="timeline-date">${date}</div>
                    <div class="timeline-content">
                        ${grouped[date].map(t => `<div style="margin-bottom:0.5rem;"><strong>${t.titulo}</strong>${t.hora ? ' - ' + t.hora : ''}</div>`).join('')}
                    </div>
                </div>
            `).join('');
            
            document.getElementById('timelineContainer').innerHTML = html;
        }

        function abrirModalNovaTarefa() {
            tempTags = [];
            tempLembretes = [];
            tempSubtarefas = [];
            tempAnexos = [];
            
            document.getElementById('novaTarefaTitulo').value = '';
            document.getElementById('novaTarefaDescricao').value = '';
            document.getElementById('novaTarefaData').value = formatDateBR(new Date());
            document.getElementById('novaTarefaHora').value = '';
            document.getElementById('novaTarefaDuracao').value = '';
            
            renderTags();
            renderLembretes();
            renderSubtarefas();
            renderAnexos();
            
            document.getElementById('modalNovaTarefa').style.display = 'block';
        }

        async function salvarNovaTarefa() {
            const titulo = document.getElementById('novaTarefaTitulo').value.trim();
            if (!titulo) { alert('‚ùå Digite o t√≠tulo da tarefa!'); return; }
            
            const descricao = document.getElementById('novaTarefaDescricao').value.trim();
            const categoria = document.getElementById('novaTarefaCategoria').value;
            const prioridade = document.getElementById('novaTarefaPrioridade').value;
            const dataFormatada = document.getElementById('novaTarefaData').value;
            const data = parseDateBR(dataFormatada);
            const hora = document.getElementById('novaTarefaHora').value;
            const duracao = parseInt(document.getElementById('novaTarefaDuracao').value) || null;
            const repetir = document.getElementById('novaTarefaRepetir').value;
            const contexto = document.getElementById('novaTarefaContexto').value;
            const energia = document.getElementById('novaTarefaEnergia').value;
            
            try {
                const novaTarefa = {
                    planner_id: plannerAberto,
                    titulo,
                    descricao,
                    categoria,
                    prioridade,
                    data,
                    data_formatada: dataFormatada,
                    hora,
                    duracao,
                    repetir,
                    contexto,
                    energia,
                    tags: tempTags,
                    lembretes: tempLembretes,
                    subtarefas: tempSubtarefas,
                    anexos: tempAnexos,
                    done: false,
                    em_progresso: false
                };
                
                await supabase.from('tarefas').insert([novaTarefa]);
                
                fecharModal('modalNovaTarefa');
                await addXP(30);
                abrirPlanner(plannerAberto);
                
                // Agendar lembretes
                agendarLembretes(novaTarefa);
                
                showNotification('‚úÖ Tarefa Criada!', titulo);
            } catch (err) {
                console.error('Erro:', err);
                alert('‚ùå Erro ao criar tarefa');
            }
        }

        function agendarLembretes(tarefa) {
            if (!tarefa.lembretes || tarefa.lembretes.length === 0) return;
            
            const dataHora = new Date(tarefa.data + ' ' + (tarefa.hora || '00:00'));
            
            tarefa.lembretes.forEach(l => {
                let tempoAntes = 0;
                if (l === '5min') tempoAntes = 5 * 60 * 1000;
                else if (l === '15min') tempoAntes = 15 * 60 * 1000;
                else if (l === '30min') tempoAntes = 30 * 60 * 1000;
                else if (l === '1h') tempoAntes = 60 * 60 * 1000;
                else if (l === '1dia') tempoAntes = 24 * 60 * 60 * 1000;
                
                const alertTime = dataHora.getTime() - tempoAntes;
                const agora = Date.now();
                
                if (alertTime > agora) {
                    setTimeout(() => {
                        showNotification('‚è∞ Lembrete: ' + tarefa.titulo, 'Tarefa programada para breve!');
                    }, alertTime - agora);
                }
            });
        }

        async function toggleTarefa(id) {
            try {
                const { data: t } = await supabase.from('tarefas').select('done').eq('id', id).single();
                await supabase.from('tarefas').update({ done: !t.done }).eq('id', id);
                if (!t.done) {
                    await addXP(20);
                    showNotification('‚úÖ Tarefa Conclu√≠da!', 'Voc√™ ganhou +20 XP!');
                }
                await checkAchievements();
                abrirPlanner(plannerAberto);
            } catch (err) {
                console.error('Erro:', err);
            }
        }

        async function editarTarefa(id) {
            alert('üöß Fun√ß√£o de edi√ß√£o avan√ßada em desenvolvimento');
        }

        async function deletarTarefa(id) {
            if (!confirm('Deletar esta tarefa?')) return;
            try {
                await supabase.from('tarefas').delete().eq('id', id);
                abrirPlanner(plannerAberto);
            } catch (err) {
                console.error('Erro:', err);
            }
        }

        async function deletarPlanner(id) {
            if (!confirm('Deletar planner e todas as tarefas?')) return;
            try {
                await supabase.from('tarefas').delete().eq('planner_id', id);
                await supabase.from('planners').delete().eq('id', id);
                planners = planners.filter(x => x.id !== id);
                renderPlanners();
            } catch (err) {
                console.error('Erro:', err);
            }
        }

        async function renderCalendar() {
            const monthNames = ['Janeiro', 'Fevereiro', 'Mar√ßo', 'Abril', 'Maio', 'Junho', 'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'];
            document.getElementById('calendarTitle').textContent = `${monthNames[currentMonth]} ${currentYear}`;
            
            const firstDay = new Date(currentYear, currentMonth, 1).getDay();
            const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();
            
            const { data: tarefas } = await supabase.from('tarefas').select('*').in('planner_id', planners.map(p => p.id));
            
            let html = '<div class="calendar-day-header">Dom</div><div class="calendar-day-header">Seg</div><div class="calendar-day-header">Ter</div><div class="calendar-day-header">Qua</div><div class="calendar-day-header">Qui</div><div class="calendar-day-header">Sex</div><div class="calendar-day-header">S√°b</div>';
            
            for (let i = 0; i < firstDay; i++) {
                html += '<div class="calendar-day"></div>';
            }
            
            for (let day = 1; day <= daysInMonth; day++) {
                const dateStr = `${currentYear}-${String(currentMonth + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                const dayTasks = tarefas?.filter(t => t.data === dateStr) || [];
                
                html += `
                    <div class="calendar-day">
                        <div class="calendar-day-number">${day}</div>
                        ${dayTasks.slice(0, 3).map(t => `<div class="calendar-task" title="${t.titulo}">${t.titulo.substring(0, 15)}</div>`).join('')}
                        ${dayTasks.length > 3 ? `<div style="font-size:0.7em; color:#666;">+${dayTasks.length - 3} mais</div>` : ''}
                    </div>
                `;
            }
            
            document.getElementById('calendarGrid').innerHTML = html;
        }

        function changeMonth(delta) {
            currentMonth += delta;
            if (currentMonth > 11) {
                currentMonth = 0;
                currentYear++;
            } else if (currentMonth < 0) {
                currentMonth = 11;
                currentYear--;
            }
            renderCalendar();
        }

        async function showAISuggestions() {
            const hour = new Date().getHours();
            const { data: tarefas } = await supabase.from('tarefas').select('*').in('planner_id', planners.map(p => p.id));
            
            if (!tarefas || tarefas.length === 0) return;
            
            const pending = tarefas.filter(t => !t.done);
            const alta = pending.filter(t => t.prioridade === 'alta' || t.prioridade === 'urgente' || t.prioridade === 'critica');
            
            let suggestion = '';
            
            if (hour >= 6 && hour < 12) {
                if (alta.length > 0) {
                    suggestion = `üåÖ Bom dia! Voc√™ tem ${alta.length} tarefa(s) de alta prioridade. Recomendo come√ßar pela mais urgente.`;
                } else {
                    suggestion = 'üåÖ Bom dia! Momento ideal para tarefas que exigem mais concentra√ß√£o.';
                }
            } else if (hour >= 12 && hour < 18) {
                suggestion = '‚òÄÔ∏è Boa tarde! Seu pico de produtividade geralmente √© agora. Aproveite!';
            } else if (hour >= 18 && hour < 22) {
                const tomorrow = tarefas.filter(t => {
                    const taskDate = new Date(t.data);
                    const tom = new Date();
                    tom.setDate(tom.getDate() + 1);
                    return taskDate.toDateString() === tom.toDateString();
                });
                if (tomorrow.length > 0) {
                    suggestion = `üåÜ Boa noite! Voc√™ tem ${tomorrow.length} tarefa(s) para amanh√£. Que tal revisar?`;
                } else {
                    suggestion = 'üåÜ Boa noite! Momento ideal para planejamento do dia seguinte.';
                }
            } else {
                suggestion = 'üåô √â tarde! Descanse bem para manter a produtividade alta amanh√£.';
            }
            
            if (currentUser.streak >= 5) {
                suggestion += ` üî• Voc√™ est√° em um streak de ${currentUser.streak} dias! Continue assim!`;
            }
            
            // Mostrar sugest√£o quando abrir um planner
            setTimeout(() => {
                const aiBox = document.getElementById('aiSuggestionBox');
                const aiText = document.getElementById('aiSuggestionText');
                if (aiBox && aiText && suggestion) {
                    aiText.textContent = suggestion;
                    aiBox.style.display = 'block';
                }
            }, 1000);
        }

        function fecharModal(id) {
            document.getElementById(id).style.display = 'none';
        }

        window.onclick = e => {
            if (e.target.classList.contains('modal')) e.target.style.display = 'none';
        };
    </script>
</body>
</html>
